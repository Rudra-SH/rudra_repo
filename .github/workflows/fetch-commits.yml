name: List Repository Commits

on:
  workflow_dispatch: # Allows manual triggering

jobs:
  list_commits:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'

      - name: Install Dependencies
        run: npm install @octokit/rest

      - name: Fetch Commits
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          owner: process.env.OWNER # Replace with the owner of the repo
          repo: process.env.OWNER   # Replace with the repository name
        uses: actions/github-script@v7
        with:
          script: |
            import { Octokit } from "@octokit/rest";
            
            const octokit = new Octokit({
              auth: process.env.GITHUB_TOKEN,
            });

            async function listCommits() {
              const owner = process.env.owner;
              const repo = process.env.repo;

              const response = await octokit.request('GET /repos/{owner}/{repo}/commits', {
                owner,
                repo,
                headers: {
                  'X-GitHub-Api-Version': '2022-11-28'
                }
              });
              return response.data;
            }

            const firstCommitResponse = await listCommits();
            console.log(firstCommitResponse);
            let start = firstCommitResponse[0].sha;
            console.log(start);
